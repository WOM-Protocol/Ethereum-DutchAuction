<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for DutchAuction/CertifierHandler.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">DutchAuction/</a> CertifierHandler.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">29.63% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>8/27</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/20</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">50% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>4/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">24.24% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>8/33</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">//! CertifierHandler contract.
//! By Parity Technologies, 2017.
//! Released under the Apache Licence 2.
&nbsp;
pragma solidity ^0.4.24;
&nbsp;
import '../Libraries/Ownable.sol';
&nbsp;
/**
 * @title Multi Certifier
 * Contract to allow multiple parties to collaborate over a certification contract.
 * Each certified account is associated with the delegate who certified it.
 * Delegates can be added and removed only by the contract owner.
 */
contract MultiCertifier {
  function certified(address _who) public constant returns (bool);
  function getCertifier(address _who) public constant returns (address);
}
&nbsp;
/// @title Certifier Handler
/// @author Nicolas Gotchac &lt;nicolas@parity.io&gt;
/// @notice This contract can be used by certified people
/// to change their certification address. How it works:
///   1. A trasaction must be sent from the first certified
///      address, which will contain as argument the new address
///      to certify
///   2. An event is emitted by the contract, which a process will
///      listen to. It will immediately call `revoke(old_address)`
///      and then `certify(new_address)` in order change the certification
///      address.
///   3. The certifier account calls `settle` so that the entry is deleted
///      from this contract.
/// A small fee will be asked in order to pay for the transaction costs (3
/// transactions are sent).
/// After the modification of the certified address, the sender and the new account
/// are both locked. This is to prevent people change constantly their certified
/// address.
contract CertifierHandler is Ownable {
  /// STORAGE
&nbsp;
  // The address of the MultiCertifier,
  // set on creation, constant
  MultiCertifier public certifier;
&nbsp;
  // A mapping of the pending requests for
  // modification of the certified address
  mapping(address =&gt; address) public pending;
&nbsp;
  // A mapping of addresses that should not
  // be able to ask for a modification request
  // (currrently limiting to 1 re-certification)
  mapping(address =&gt; bool) public locked;
&nbsp;
  // Count of the pending requests. This should
  // be 0 most of the time.
  uint public count;
&nbsp;
  // The fee the users should be pay, that covers
  // the costs of sending 3 transactions.
  // This fee can be modified by the contract owner.
  uint public fee;
&nbsp;
  // The treasury to which the funds are sent
  address public treasury;
&nbsp;
  /// EVENTS
&nbsp;
  // Emitted when the contract is drained
  event Drained (uint _balance);
  // Emitted when an account is locked
  event Locked (address _who);
  // Emitted when a new fee is set
  event NewFee(uint _oldFee, uint _newFee);
  // Emitted when the treasury is modified
  event NewTreasury(address _oldTreasury, address _newTreasury);
  // Emitted when a new modification request is received
  event Requested (address _sender, address _who);
  // Emitted when a request has been cleared ; meaning the
  // certified account has been transfered
  event Transfered (address _sender, address _who, address _certifier);
&nbsp;
  /// MODIFIERS
&nbsp;
<span class="fstat-no" title="function not covered" >  modifier only_unlocked (address _who) </span>{
<span class="cstat-no" title="statement not covered" >    require(!locked[_who])</span>;
    _;
  }
&nbsp;
  /// CONSTRUCTOR
&nbsp;
  /// @notice Contructor method of the contract, which
  /// will set the `certifier` address
  /// @param _certifier The address of the main certifier
  /// @param _treasury The address of the treasury
  constructor(address _certifier, address _treasury) public {
    certifier = MultiCertifier(_certifier);
    treasury = _treasury;
  }
&nbsp;
  /**
   *  Contracts should reject unexpected payments. Before Solidity 0.4.0, it was done manually
   */
&nbsp;
  /// PUBLIC METHODS
&nbsp;
  /// @notice This method will be called by certified
  /// accounts that which to certify another address.
  /// This function can only be called once per user.
  /// After a successful re-certification, these two accounts
  /// are locked, and cannot ask for another re-certification.
  /// @param who The address to which the certification should be
  ///            transfered
<span class="fstat-no" title="function not covered" >  function claim (address who)</span>
    public payable
    only_unlocked(msg.sender)
    only_unlocked(who)
  {
    // Make sure that the fee is paid
<span class="cstat-no" title="statement not covered" >    require(msg.value &gt;= fee)</span>;
    // The sender should not have a pending certification transfer
<span class="cstat-no" title="statement not covered" >    require(pending[msg.sender] == 0x0)</span>;
    // Cannot transfer to 0x0 account
<span class="cstat-no" title="statement not covered" >    require(who != 0x0)</span>;
    // The sender should already be certified
<span class="cstat-no" title="statement not covered" >    require(certifier.certified(msg.sender))</span>;
    // The new address shouldn't already be certified
<span class="cstat-no" title="statement not covered" >    require(!certifier.certified(who))</span>;
    // Ensure that the owner of the contract is the
    // certifier of the sender
<span class="cstat-no" title="statement not covered" >    require(certifier.getCertifier(msg.sender) == owner)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >    pending[msg.sender] = who</span>;
    count++;
&nbsp;
    // Send the event
<span class="cstat-no" title="statement not covered" >    emit Requested(msg.sender, who);</span>
&nbsp;
    // Transfer the funds to the treasury
    treasury.transfer(msg.value);
  }
&nbsp;
  /// @notice This method is called by the certifier account
  /// in order to remove the pending request of modification
  /// of the certified address.
  /// Anyone can call this method, since it checks that the
  /// pending request has actually gone through (modification
  /// of certification address)
<span class="fstat-no" title="function not covered" >  function settle (address sender) public </span>{
<span class="cstat-no" title="statement not covered" >    address who = pending[sender]</span>;
&nbsp;
    // Ensure that there is a pending transfer
<span class="cstat-no" title="statement not covered" >    require(who != 0x0)</span>;
    // Ensure that the new address has been certified
<span class="cstat-no" title="statement not covered" >    require(certifier.certified(who))</span>;
    // Ensure that the old address has been revoked
<span class="cstat-no" title="statement not covered" >    require(!certifier.certified(sender))</span>;
&nbsp;
    // Delete the pending entry
    delete pending[sender];
    count--;
&nbsp;
    // Lock the accounts
<span class="cstat-no" title="statement not covered" >    locked[sender] = true</span>;
<span class="cstat-no" title="statement not covered" >    locked[who] = true</span>;
&nbsp;
    // Send the Locked events
<span class="cstat-no" title="statement not covered" >    emit Locked(sender);</span>
<span class="cstat-no" title="statement not covered" >    emit Locked(who);</span>
&nbsp;
    // Send the event
<span class="cstat-no" title="statement not covered" >    emit Transfered(sender, who, msg.sender);</span>
  }
&nbsp;
  /// RESTRICTED (owner or delegate only) PUBLIC METHODS
&nbsp;
  /// @notice Send the current balance to the treasury.
  /// Could be needed if value is sent outside of the `claim`
  /// method (eg. contract suicide)
<span class="fstat-no" title="function not covered" >  function drain () external onlyOwner </span>{
<span class="cstat-no" title="statement not covered" >    emit Drained(address(this).balance);</span>
    treasury.transfer(address(this).balance);
  }
&nbsp;
  /// @notice Change the fee, needed if for whatever reason gas price
  /// must be modified. Only the owner of the contract
  /// can execute this method.
  /// @param _fee The new fee
  function setFee (uint _fee) external onlyOwner {
    emit NewFee(fee, _fee);
    fee = _fee;
  }
&nbsp;
  /// @notice The owner can lock an account, which is
  /// basically a blacklist. This shouldn't be used
  /// often ; but could be useful for re-deployment of
  /// new contract for example.
  /// @param _who The account to lock.
  function setLocked (address _who) external onlyOwner {
    emit Locked(_who);
    locked[_who] = true;
  }
&nbsp;
  /// @notice Change the address of the treasury, the address to which
  /// the payments are forwarded to. Only the owner of the contract
  /// can execute this method.
  /// @param _treasury The new treasury address
  function setTreasury (address _treasury) external onlyOwner {
    emit NewTreasury(treasury, _treasury);
    treasury = _treasury;
  }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Nov 12 2018 13:35:39 GMT+0000 (Greenwich Mean Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
